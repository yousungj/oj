<!DOCTYPE html>
<html>
<head>
    <title>ë¹„ë°€ ìš”ì› ë¯¸ì…˜</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <link rel="stylesheet" href="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>

    <style>
        body { background-color: #1a1a1a; color: #00ff00; font-family: 'Courier New', monospace; text-align: center; padding: 20px; }
        .container { max-width: 600px; margin: 0 auto; background: #000; padding: 20px; border: 2px solid #00ff00; border-radius: 10px; }
        input { font-size: 20px; padding: 10px; text-align: center; width: 80%; background: #333; color: white; border: 1px solid #00ff00; }
        button { font-size: 18px; padding: 10px 30px; background: #00ff00; color: black; border: none; cursor: pointer; margin-top: 15px; font-weight: bold; }
        button:hover { background: white; }
        .hidden { display: none; }
        #board { width: 100%; margin: 20px auto; }
        .message { color: yellow; font-size: 18px; margin: 10px 0; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ•µï¸ ë¹„ë°€ ìš”ì›: ì‘ì „ëª… ì•ŒíŒŒ</h1>
    <hr style="border-color: #00ff00;">

    <div id="level1">
        <h3>ë ˆë²¨ 1: ì•”í˜¸ í•´ë…</h3>
        <p>ë„ì‹œë„ ìˆê³  ì‚°ë„ ìˆê³  ê°•ë„ ìˆì§€ë§Œ,<br>ì‚¬ëŒë„ ë‚˜ë¬´ë„ ë¬¼ê³ ê¸°ë„ ì—†ëŠ” ê²ƒì€?</p>
        <input type="text" id="ans1" placeholder="ì •ë‹µì„ ì…ë ¥í•˜ì„¸ìš”">
        <br>
        <button onclick="checkLevel1()">ì œì¶œ</button>
        <p id="msg1" class="message"></p>
    </div>

    <div id="level2" class="hidden">
        <h3>ë ˆë²¨ 2: ìµœí›„ì˜ ì¼ê²©</h3>
        <p>ì»´í“¨í„°ê°€ ë°©ì‹¬í–ˆë‹¤! <br><strong>ë°±(White)ì´ í•œ ìˆ˜ë§Œ ë‘ë©´ ì´ê¹ë‹ˆë‹¤.</strong><br>ì²´í¬ë©”ì´íŠ¸ë¥¼ ë§Œë“œì„¸ìš”!</p>
        <div id="board"></div>
        <p id="status">ë°±(White) ì°¨ë¡€ì…ë‹ˆë‹¤. ë“œë˜ê·¸í•´ì„œ ë‘ì„¸ìš”.</p>
    </div>

    <div id="level3" class="hidden">
        <h1>ğŸ† ì‘ì „ ì„±ê³µ! ğŸ†</h1>
        <p>ì¶•í•˜í•©ë‹ˆë‹¤, ìš”ì›ë‹˜.</p>
        <p>ë³´ë¬¼ì€ ë‹¤ìŒ ì¥ì†Œì— ìˆ¨ê²¨ì ¸ ìˆìŠµë‹ˆë‹¤:</p>
        <div style="border: 2px dashed yellow; padding: 20px; margin-top: 20px; color: yellow; font-size: 24px;">
            ê±°ì‹¤ ì†ŒíŒŒ ì¿ ì…˜ ì•„ë˜
        </div>
    </div>

</div>

<script>
    // --- ë ˆë²¨ 1 ë¡œì§ ---
    function checkLevel1() {
        var answer = document.getElementById('ans1').value.replace(/\s/g, '').toLowerCase(); // ê³µë°±ì œê±° ë° ì†Œë¬¸ì ë³€í™˜
        // ì •ë‹µ: ì§€ë„ ë˜ëŠ” map
        if (answer === "ì§€ë„" || answer === "map") {
            document.getElementById('level1').classList.add('hidden');
            document.getElementById('level2').classList.remove('hidden');
            initChess(); // ì²´ìŠ¤ ê²Œì„ ì‹œì‘
        } else {
            document.getElementById('msg1').innerText = "ì ‘ê·¼ ê±°ë¶€: ì•”í˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.";
        }
    }

    // --- ë ˆë²¨ 2 ë¡œì§ (ì²´ìŠ¤) ---
    var board = null;
    var game = new Chess();

    function initChess() {
        // í¼ì¦ ì„¸íŒ…: ë°±ì´ ë£©ì„ ì˜®ê¸°ë©´ ë°”ë¡œ ì´ê¸°ëŠ” ìƒí™© (Back Rank Mate)
        // ë°± ë£©: e1, í‘ í‚¹: g8, í‘ í°ë“¤: f7, g7, h7 (ë„ë§ ëª» ê°)
        var puzzleFEN = '6k1/5ppp/8/8/8/8/8/4R1K1 w - - 0 1';
        game.load(puzzleFEN);

        var config = {
            draggable: true,
            position: puzzleFEN,
            onDragStart: onDragStart,
            onDrop: onDrop,
            onSnapEnd: onSnapEnd
        };
        board = Chessboard('board', config);
        
        // ëª¨ë°”ì¼ì—ì„œ í¬ê¸° ì¡°ì ˆ
        window.setTimeout(function() { board.resize(); }, 500);
    }

    function onDragStart (source, piece) {
        // ê²Œì„ì´ ëë‚¬ê±°ë‚˜ í‘(ê²€ì€ìƒ‰) ê¸°ë¬¼ì„ ë§Œì§€ë ¤ê³  í•˜ë©´ ëª»í•˜ê²Œ ë§‰ìŒ
        if (game.game_over() || piece.search(/^b/) !== -1) {
            return false;
        }
    }

    function onDrop (source, target) {
        // ì´ë™ ì‹œë„
        var move = game.move({
            from: source,
            to: target,
            promotion: 'q' // í°ì´ ëê¹Œì§€ ê°€ë©´ ìë™ìœ¼ë¡œ í€¸ìœ¼ë¡œ ë³€ì‹ 
        });

        // ë¶ˆê°€ëŠ¥í•œ ìˆ˜ë¼ë©´ ì›ë˜ëŒ€ë¡œ ëŒë ¤ë†“ìŒ
        if (move === null) return 'snapback';

        // ì²´í¬ë©”ì´íŠ¸ì¸ì§€ í™•ì¸
        if (game.in_checkmate()) {
            document.getElementById('status').innerText = "ì²´í¬ë©”ì´íŠ¸! ìŠ¹ë¦¬!";
            // 1.5ì´ˆ ë’¤ì— ë ˆë²¨ 3 í™”ë©´ìœ¼ë¡œ ë„˜ì–´ê°
            setTimeout(function() {
                document.getElementById('level2').classList.add('hidden');
                document.getElementById('level3').classList.remove('hidden');
            }, 1500);
        } else {
            // ì²´í¬ë©”ì´íŠ¸ê°€ ì•„ë‹ˆë©´ ë‹¤ì‹œ ë‘ê²Œ í•¨ (í¼ì¦ì´ë¯€ë¡œ)
            alert("ê·¸ ìˆ˜ëŠ” ì²´í¬ë©”ì´íŠ¸ê°€ ì•„ë‹™ë‹ˆë‹¤! ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.");
            game.undo(); // ìˆ˜ ë¬´ë¥´ê¸°
            return 'snapback';
        }
    }

    function onSnapEnd () {
        board.position(game.fen());
    }
</script>

</body>
</html>
