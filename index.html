<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>üè¥‚Äç‚ò†Ô∏è Treasure Hunt Adventure</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <link rel="stylesheet" href="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        
        * { box-sizing: border-box; }
        body { 
            background: #8B7355;
            background-image: 
                linear-gradient(45deg, #654321 25%, transparent 25%),
                linear-gradient(-45deg, #654321 25%, transparent 25%),
                linear-gradient(45deg, transparent 75%, #654321 75%),
                linear-gradient(-45deg, transparent 75%, #654321 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
            color: #fff; 
            font-family: 'Press Start 2P', 'Courier New', monospace; 
            text-align: center; 
            padding: 20px;
            min-height: 100vh;
            image-rendering: pixelated;
        }
        .container { 
            max-width: 700px; 
            margin: 0 auto; 
            background: rgba(54, 47, 45, 0.95); 
            padding: 30px; 
            border: 8px solid #5A5A5A;
            border-style: solid;
            box-shadow: 
                inset 4px 4px 0 rgba(0,0,0,0.3),
                inset -4px -4px 0 rgba(255,255,255,0.1),
                0 8px 0 #3A3A3A;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }
        p {
            word-wrap: break-word;
            overflow-wrap: break-word;
            font-size: 12px;
            line-height: 1.8;
        }
        .main-image {
            width: 100%;
            max-width: 350px;
            border: 4px solid #5A5A5A;
            margin-bottom: 20px;
            image-rendering: pixelated;
        }
        .progress-bar {
            width: 100%;
            height: 32px;
            background: #1a1a1a;
            border: 4px solid #5A5A5A;
            margin-bottom: 20px;
            overflow: hidden;
            box-shadow: inset 2px 2px 0 rgba(0,0,0,0.5);
        }
        .progress-fill {
            height: 100%;
            background: #55FF55;
            background-image: repeating-linear-gradient(
                90deg,
                #55FF55 0px,
                #55FF55 4px,
                #44DD44 4px,
                #44DD44 8px
            );
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #000;
            text-shadow: 2px 2px 0 rgba(0,0,0,0.3);
            font-size: 10px;
        }
        h1 { 
            color: #FFFF55; 
            text-shadow: 3px 3px 0 rgba(0,0,0,0.5);
            font-size: 16px;
            margin-bottom: 15px;
            line-height: 1.6;
        }
        h3 { 
            color: #55FFFF; 
            margin-top: 20px;
            font-size: 14px;
            text-shadow: 2px 2px 0 rgba(0,0,0,0.5);
        }
        input { 
            font-size: 14px; 
            padding: 12px; 
            text-align: center; 
            width: 90%; 
            max-width: 300px;
            background: #fff; 
            color: #000; 
            border: 4px solid #5A5A5A;
            margin: 10px 0;
            font-family: 'Press Start 2P', monospace;
            box-shadow: inset 2px 2px 0 rgba(0,0,0,0.3);
        }
        button { 
            font-size: 10px; 
            padding: 12px 20px; 
            background: #7DBE3B; 
            color: #fff; 
            border: 4px solid #5A5A5A;
            cursor: pointer; 
            margin: 10px 5px;
            font-weight: bold;
            font-family: 'Press Start 2P', monospace;
            box-shadow: 
                inset 2px 2px 0 rgba(255,255,255,0.3),
                inset -2px -2px 0 rgba(0,0,0,0.3),
                0 4px 0 #2A5A1A;
            transition: all 0.1s;
            position: relative;
        }
        button:hover { 
            background: #8DD84B; 
            top: 2px;
            box-shadow: 
                inset 2px 2px 0 rgba(255,255,255,0.3),
                inset -2px -2px 0 rgba(0,0,0,0.3),
                0 2px 0 #2A5A1A;
        }
        button:active {
            top: 4px;
            box-shadow: 
                inset 2px 2px 0 rgba(0,0,0,0.3),
                0 0 0 #2A5A1A;
        }
        .hidden { display: none; }
        #board { 
            width: 400px !important; 
            max-width: 90%; 
            margin: 20px auto;
        }
        #board img {
            image-rendering: auto !important;
            filter: none !important;
        }
        #board .square-55d63 {
            image-rendering: auto !important;
        }
        .white-1e1d7 {
            background-color: #f0d9b5 !important;
        }
        .black-3c85d {
            background-color: #b58863 !important;
        }
        .message { 
            color: #FFFF55; 
            font-size: 11px; 
            margin: 15px 0;
            min-height: 25px;
            text-shadow: 2px 2px 0 rgba(0,0,0,0.5);
        }
        .treasure-box { 
            border: 6px solid #FFD700; 
            padding: 25px; 
            margin-top: 20px; 
            background: #8B7355;
            font-size: 14px;
            font-weight: bold;
            animation: glow 2s infinite;
            box-shadow: 
                inset 3px 3px 0 rgba(255,255,255,0.2),
                inset -3px -3px 0 rgba(0,0,0,0.3),
                0 0 20px rgba(255,215,0,0.5);
        }
        @keyframes glow {
            0%, 100% { box-shadow: 
                inset 3px 3px 0 rgba(255,255,255,0.2),
                inset -3px -3px 0 rgba(0,0,0,0.3),
                0 0 20px rgba(255,215,0,0.5); }
            50% { box-shadow: 
                inset 3px 3px 0 rgba(255,255,255,0.2),
                inset -3px -3px 0 rgba(0,0,0,0.3),
                0 0 40px rgba(255,215,0,0.8); }
        }
        .math-problem {
            font-size: 20px;
            color: #FFFF55;
            margin: 20px 0;
            font-weight: bold;
            text-shadow: 2px 2px 0 rgba(0,0,0,0.5);
        }
        .puzzle-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 4px;
            max-width: 400px;
            margin: 20px auto;
            background: #3A3A3A;
            padding: 8px;
            border: 4px solid #5A5A5A;
            box-shadow: inset 2px 2px 0 rgba(0,0,0,0.5);
        }
        .puzzle-tile {
            aspect-ratio: 1;
            background: #8B7355;
            background-image: repeating-linear-gradient(
                0deg,
                transparent,
                transparent 8px,
                rgba(0,0,0,0.1) 8px,
                rgba(0,0,0,0.1) 16px
            );
            border: 4px solid #5A5A5A;
            font-size: 32px;
            font-weight: bold;
            color: #fff;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.1s;
            user-select: none;
            text-shadow: 3px 3px 0 rgba(0,0,0,0.5);
            box-shadow: 
                inset 2px 2px 0 rgba(255,255,255,0.2),
                inset -2px -2px 0 rgba(0,0,0,0.3);
        }
        .puzzle-tile:hover {
            background: #9B8365;
            top: 1px;
            position: relative;
        }
        .puzzle-tile.empty {
            background: #2A2A2A;
            cursor: default;
            box-shadow: inset 3px 3px 0 rgba(0,0,0,0.5);
        }
        .upload-area {
            border: 4px solid #5A5A5A;
            padding: 30px;
            margin: 20px 0;
            background: rgba(139, 115, 85, 0.3);
            box-shadow: inset 2px 2px 0 rgba(0,0,0,0.3);
        }
        .upload-preview {
            max-width: 100%;
            max-height: 300px;
            margin-top: 15px;
            border: 4px solid #5A5A5A;
            image-rendering: pixelated;
        }
        #fileInput {
            display: none;
        }
        .file-button {
            background: #4A9BD1;
            color: #fff;
            box-shadow: 
                inset 2px 2px 0 rgba(255,255,255,0.3),
                inset -2px -2px 0 rgba(0,0,0,0.3),
                0 4px 0 #2A5A8A;
        }
        .file-button:hover {
            background: #5AABD1;
        }
        .stage-icon {
            font-size: 48px;
            margin: 15px 0;
            filter: drop-shadow(3px 3px 0 rgba(0,0,0,0.5));
        }
        hr {
            border: none;
            height: 4px;
            background: #5A5A5A;
            margin: 20px 0;
            box-shadow: 0 2px 0 rgba(0,0,0,0.3);
        }
    </style>
</head>
<body>

<div class="container">
    <!-- Progress Bar -->
    <div class="progress-bar">
        <div class="progress-fill" id="progressBar" style="width: 0%;">Stage 0/6</div>
    </div>

    <!-- STAGE 1: NAME ENTRY -->
    <div id="stage1">
        <img src="main1.png" alt="Mystery in Rolling Hills" class="main-image">
        
        <h1>üîç MYSTERY IN ROLLING HILLS ESTATES üîç</h1>
        
        <div style="background: rgba(0,0,0,0.5); padding: 20px; margin: 20px 0; border: 4px solid #FF6B6B; box-shadow: inset 2px 2px 0 rgba(0,0,0,0.3);">
            <p style="font-size: 13px; line-height: 2; color: #FFFF55;">
                In the middle of the night in quiet Rolling Hills Estates, a lady named <strong style="color: #FF6B6B;">June</strong> disappeared. 
                To help find her, the community called upon the <strong style="color: #55FFFF;">RHCC kids</strong> to find the clues.
            </p>
            <p style="font-size: 13px; line-height: 2; color: #FFFF55; margin-top: 15px;">
                Now gather at least <strong style="color: #55FF55;">5 kids</strong> and solve the clues together.
            </p>
            <p style="font-size: 14px; color: #FF6B6B; margin-top: 15px; font-weight: bold;">
                Good luck. June's life depends on you! üö®
            </p>
        </div>
        
        <hr style="border-color: #ffd700;">
        
        <div class="stage-icon">üë•</div>
        <h3>STAGE 1: ASSEMBLE YOUR TEAM</h3>
        <p>Enter the names of all detectives joining the search!</p>
        <p style="font-size: 11px; color: #aaa;">You need at least 5 kids to start</p>
        
        <div style="margin: 20px 0;">
            <input type="text" id="nameInput" placeholder="Enter detective name" style="max-width: 300px;">
            <br>
            <button onclick="addName()">ADD DETECTIVE</button>
        </div>
        
        <div id="nameList" style="margin: 20px 0; min-height: 100px; background: rgba(0,0,0,0.3); padding: 15px; border: 2px solid #5A5A5A;">
            <p style="font-size: 11px; color: #aaa;">Team Members: <span id="nameCount">0</span></p>
            <div id="names" style="margin-top: 10px;"></div>
        </div>
        
        <button onclick="startMission()" id="startBtn" style="background: #FF6B6B; box-shadow: inset 2px 2px 0 rgba(255,255,255,0.3), inset -2px -2px 0 rgba(0,0,0,0.3), 0 4px 0 #8A2A2A;" disabled>START MISSION</button>
        <p id="nameMsg" class="message"></p>
    </div>

    <!-- STAGE 2: MATH PROBLEMS -->
    <div id="stage2" class="hidden">
        <div class="stage-icon">üî¢</div>
        <h3>STAGE 2: MATH CHALLENGE</h3>
        
        <div style="background: rgba(0,0,0,0.5); padding: 15px; margin: 15px 0; border: 2px solid #55FFFF;">
            <p style="font-size: 12px; line-height: 2; color: #FFFF55;">
                To check if you are capable of solving the mystery, please show your intelligence by solving these math problems.
            </p>
        </div>
        
        <div class="math-problem" id="mathProblem">5 + 3 = ?</div>
        <input type="number" id="mathAnswer" placeholder="Your answer">
        <br>
        <button onclick="checkMath()">SUBMIT ANSWER</button>
        <p id="mathMsg" class="message"></p>
        <p style="color: #aaa; font-size: 14px;">Problem <span id="mathProgress">1</span> of 3</p>
    </div>

    <!-- STAGE 3: CHESS GAME -->
    <div id="stage3" class="hidden">
        <div class="stage-icon">‚ôüÔ∏è</div>
        <h3>STAGE 3: CHESS MASTER</h3>
        <p>Find the checkmate in 1 move!</p>
        <p style="color: #00ffff;">You are playing as White. Drag a piece to win!</p>
        <div id="board"></div>
        <p id="status" class="message">Your Turn (White)</p>
    </div>

    <!-- STAGE 4: SLIDING PUZZLE -->
    <div id="stage4" class="hidden">
        <div class="stage-icon">üß©</div>
        <h3>STAGE 4: NUMBER PUZZLE</h3>
        <p>Arrange the numbers from 1 to 8 in order!</p>
        <p style="color: #aaa; font-size: 14px;">Click tiles next to the empty space to move them</p>
        
        <div class="puzzle-grid" id="puzzleGrid"></div>
        <button onclick="shufflePuzzle()">SHUFFLE</button>
        <button onclick="checkPuzzle()">CHECK SOLUTION</button>
        <p id="puzzleMsg" class="message"></p>
    </div>

    <!-- STAGE 5: PHOTO UPLOAD -->
    <div id="stage5" class="hidden">
        <div class="stage-icon">üì∏</div>
        <h3>STAGE 5: PHOTO MISSION</h3>
        <p><strong>Your mission:</strong></p>
        <p style="font-size: 20px; color: #ffd700;">Find something RED in your house<br>and take a photo of it!</p>
        
        <div class="upload-area">
            <p>üì± Click below to upload your photo</p>
            <input type="file" id="fileInput" accept="image/*" onchange="previewPhoto()">
            <button class="file-button" onclick="document.getElementById('fileInput').click()">
                CHOOSE PHOTO
            </button>
            <div id="photoPreview"></div>
        </div>
        <button onclick="checkPhoto()" id="submitPhotoBtn" class="hidden">SUBMIT PHOTO</button>
        <p id="photoMsg" class="message"></p>
    </div>

    <!-- STAGE 6: TREASURE FOUND! -->
    <div id="stage6" class="hidden">
        <div class="stage-icon">üéâ</div>
        <h1>üèÜ CONGRATULATIONS! üèÜ</h1>
        <p style="font-size: 22px;">You've completed all the challenges!</p>
        <p style="font-size: 18px;">Your treasure awaits...</p>
        
        <div class="treasure-box">
            <div>üéÅ SECRET CODE üéÅ</div>
            <div style="font-size: 48px; margin-top: 15px; letter-spacing: 5px;">
                CHAMPION
            </div>
        </div>
        
        <p style="margin-top: 25px; font-size: 20px; color: #00ff00;">
            Use this code to unlock your treasure box!
        </p>
        <p style="font-size: 16px; color: #aaa; margin-top: 20px;">
            Amazing work! You're a true treasure hunter! üåü
        </p>
    </div>

</div>

<script>
    let currentStage = 1;
    let detectives = [];
    
    // Update progress bar
    function updateProgress() {
        const progressBar = document.getElementById('progressBar');
        const percentage = (currentStage / 6) * 100;
        progressBar.style.width = percentage + '%';
        progressBar.textContent = 'Stage ' + currentStage + '/6';
    }
    
    // ====== STAGE 1: NAME ENTRY ======
    function addName() {
        const input = document.getElementById('nameInput');
        const name = input.value.trim();
        const msgEl = document.getElementById('nameMsg');
        
        if (name === '') {
            msgEl.textContent = '‚ùå Please enter a name!';
            msgEl.style.color = '#ff0000';
            return;
        }
        
        if (detectives.includes(name)) {
            msgEl.textContent = '‚ùå This name is already added!';
            msgEl.style.color = '#ff0000';
            return;
        }
        
        detectives.push(name);
        input.value = '';
        updateNameList();
        msgEl.textContent = '‚úÖ ' + name + ' joined the team!';
        msgEl.style.color = '#00ff00';
        
        setTimeout(() => {
            msgEl.textContent = '';
        }, 2000);
    }
    
    function updateNameList() {
        const namesDiv = document.getElementById('names');
        const countSpan = document.getElementById('nameCount');
        const startBtn = document.getElementById('startBtn');
        
        countSpan.textContent = detectives.length;
        
        namesDiv.innerHTML = detectives.map((name, index) => 
            '<div style="display: inline-block; background: #7DBE3B; color: #fff; padding: 8px 12px; margin: 5px; border: 2px solid #5A5A5A; font-size: 10px;">' +
            'üë§ ' + name + 
            ' <span onclick="removeName(' + index + ')" style="cursor: pointer; margin-left: 8px; color: #ff0000; font-weight: bold;">‚úñ</span>' +
            '</div>'
        ).join('');
        
        if (detectives.length >= 5) {
            startBtn.disabled = false;
            startBtn.style.opacity = '1';
        } else {
            startBtn.disabled = true;
            startBtn.style.opacity = '0.5';
        }
    }
    
    function removeName(index) {
        detectives.splice(index, 1);
        updateNameList();
    }
    
    function startMission() {
        const msgEl = document.getElementById('nameMsg');
        msgEl.textContent = 'üöÄ Mission starting! Good luck team!';
        msgEl.style.color = '#00ff00';
        
        setTimeout(() => {
            nextStage('stage1', 'stage2');
        }, 1500);
    }
    
    // Allow Enter key for name input
    document.addEventListener('DOMContentLoaded', function() {
        const nameInput = document.getElementById('nameInput');
        if (nameInput) {
            nameInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') addName();
            });
        }
        
        const mathInput = document.getElementById('mathAnswer');
        if (mathInput) {
            mathInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') checkMath();
            });
        }
    });
    
    // Go to next stage
    function nextStage(current, next) {
        document.getElementById(current).classList.add('hidden');
        document.getElementById(next).classList.remove('hidden');
        currentStage++;
        updateProgress();
        window.scrollTo(0, 0);
    }
    
    // ====== STAGE 1: MATH PROBLEMS ======
    const mathProblems = [
        { question: "5 + 3 = ?", answer: 8 },
        { question: "12 - 7 = ?", answer: 5 },
        { question: "4 √ó 3 = ?", answer: 12 }
    ];
    let currentMathProblem = 0;
    
    function checkMath() {
        const userAnswer = parseInt(document.getElementById('mathAnswer').value);
        const correctAnswer = mathProblems[currentMathProblem].answer;
        const msgEl = document.getElementById('mathMsg');
        
        if (userAnswer === correctAnswer) {
            currentMathProblem++;
            
            if (currentMathProblem < mathProblems.length) {
                // Next problem
                msgEl.textContent = "‚úÖ Correct! Next problem...";
                msgEl.style.color = "#00ff00";
                document.getElementById('mathAnswer').value = '';
                
                setTimeout(() => {
                    document.getElementById('mathProblem').textContent = 
                        mathProblems[currentMathProblem].question;
                    document.getElementById('mathProgress').textContent = 
                        (currentMathProblem + 1);
                    msgEl.textContent = '';
                }, 1000);
            } else {
                // All problems solved!
                msgEl.textContent = "üéâ Perfect! Moving to Stage 3...";
                msgEl.style.color = "#00ff00";
                setTimeout(() => {
                    nextStage('stage2', 'stage3');
                    initChess();
                }, 1500);
            }
        } else {
            msgEl.textContent = "‚ùå Try again!";
            msgEl.style.color = "#ff0000";
        }
    }
    
    // ====== STAGE 2: MATH PROBLEMS (Continued) ======
    
    // ====== STAGE 3: CHESS ======
    var board = null;
    var game = new Chess();

    function initChess() {
        // Setup Puzzle: Back Rank Mate
        var puzzleFEN = '6k1/5ppp/8/8/8/8/8/4R1K1 w - - 0 1';
        game.load(puzzleFEN);

        var config = {
            draggable: true,
            position: puzzleFEN,
            onDragStart: onDragStart,
            onDrop: onDrop,
            onSnapEnd: onSnapEnd,
            pieceTheme: 'https://chessboardjs.com/img/chesspieces/wikipedia/{piece}.png'
        };
        board = Chessboard('board', config);
        
        // Resize for mobile screens
        window.setTimeout(function() { 
            board.resize(); 
        }, 500);
    }

    function onDragStart(source, piece) {
        // Prevent moving black pieces or if game over
        if (game.game_over() || piece.search(/^b/) !== -1) {
            return false;
        }
    }

    function onDrop(source, target) {
        // Try move
        var move = game.move({
            from: source,
            to: target,
            promotion: 'q'
        });

        // Illegal move -> snapback
        if (move === null) return 'snapback';

        // Check for Checkmate
        if (game.in_checkmate()) {
            document.getElementById('status').innerText = "‚úÖ CHECKMATE! YOU WIN!";
            document.getElementById('status').style.color = "#00ff00";
            // Wait 1.5 seconds then show next stage
            setTimeout(function() {
                nextStage('stage3', 'stage4');
                initPuzzle();
            }, 1500);
        } else {
            // Not checkmate
            alert("That's not checkmate! Try again.");
            game.undo();
            return 'snapback';
        }
    }

    function onSnapEnd() {
        board.position(game.fen());
    }
    
    // ====== STAGE 3: SLIDING PUZZLE ======
    let puzzleState = [1, 2, 3, 4, 5, 6, 7, 8, 0]; // 0 = empty
    
    function initPuzzle() {
        renderPuzzle();
        shufflePuzzle();
    }
    
    function renderPuzzle() {
        const grid = document.getElementById('puzzleGrid');
        grid.innerHTML = '';
        
        puzzleState.forEach((num, index) => {
            const tile = document.createElement('div');
            tile.className = 'puzzle-tile' + (num === 0 ? ' empty' : '');
            tile.textContent = num === 0 ? '' : num;
            tile.onclick = () => moveTile(index);
            grid.appendChild(tile);
        });
    }
    
    function moveTile(index) {
        const emptyIndex = puzzleState.indexOf(0);
        const row = Math.floor(index / 3);
        const col = index % 3;
        const emptyRow = Math.floor(emptyIndex / 3);
        const emptyCol = emptyIndex % 3;
        
        // Check if adjacent
        if ((Math.abs(row - emptyRow) === 1 && col === emptyCol) ||
            (Math.abs(col - emptyCol) === 1 && row === emptyRow)) {
            // Swap
            [puzzleState[index], puzzleState[emptyIndex]] = 
                [puzzleState[emptyIndex], puzzleState[index]];
            renderPuzzle();
        }
    }
    
    function shufflePuzzle() {
        // Simple shuffle
        for (let i = 0; i < 100; i++) {
            const emptyIndex = puzzleState.indexOf(0);
            const neighbors = [];
            
            const row = Math.floor(emptyIndex / 3);
            const col = emptyIndex % 3;
            
            if (row > 0) neighbors.push(emptyIndex - 3);
            if (row < 2) neighbors.push(emptyIndex + 3);
            if (col > 0) neighbors.push(emptyIndex - 1);
            if (col < 2) neighbors.push(emptyIndex + 1);
            
            const randomNeighbor = neighbors[Math.floor(Math.random() * neighbors.length)];
            [puzzleState[emptyIndex], puzzleState[randomNeighbor]] = 
                [puzzleState[randomNeighbor], puzzleState[emptyIndex]];
        }
        renderPuzzle();
        document.getElementById('puzzleMsg').textContent = '';
    }
    
    function checkPuzzle() {
        const solved = puzzleState.every((num, index) => 
            index === 8 ? num === 0 : num === index + 1
        );
        
        const msgEl = document.getElementById('puzzleMsg');
        if (solved) {
            msgEl.textContent = "üéâ Puzzle Solved! Moving to Stage 5...";
            msgEl.style.color = "#00ff00";
            setTimeout(() => {
                nextStage('stage4', 'stage5');
            }, 1500);
        } else {
            msgEl.textContent = "‚ùå Not quite right. Keep trying!";
            msgEl.style.color = "#ff0000";
        }
    }
    
    // ====== STAGE 4: PHOTO UPLOAD ======
    let photoUploaded = false;
    
    function previewPhoto() {
        const file = document.getElementById('fileInput').files[0];
        const preview = document.getElementById('photoPreview');
        const submitBtn = document.getElementById('submitPhotoBtn');
        
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                preview.innerHTML = '<img src="' + e.target.result + 
                    '" class="upload-preview" alt="Your photo">';
                photoUploaded = true;
                submitBtn.classList.remove('hidden');
            };
            reader.readAsDataURL(file);
        }
    }
    
    function checkPhoto() {
        const msgEl = document.getElementById('photoMsg');
        
        if (photoUploaded) {
            msgEl.textContent = "üì∏ Perfect! Great photo! Moving to final stage...";
            msgEl.style.color = "#00ff00";
            setTimeout(() => {
                nextStage('stage5', 'stage6');
            }, 2000);
        } else {
            msgEl.textContent = "‚ùå Please upload a photo first!";
            msgEl.style.color = "#ff0000";
        }
    }
    
    // Initialize
    updateProgress();
</script>

</body>
</html>
